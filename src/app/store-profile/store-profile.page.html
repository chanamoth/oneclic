<app-shared-header title="{{ comercio?.nombre }}" [isLoading]="isLoading" [scrolled]="scrolled"></app-shared-header>

<ion-content [fullscreen]="true" color="light" (ionScroll)="onScroll($event)" scrollEvents="true">

  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content pullingText="Tira para refrescar" refreshingSpinner="crescent"></ion-refresher-content>
  </ion-refresher>

  <!-- Banner de la tienda -->
  <div class="store-banner">
    <img [src]="comercio?.folder + comercio?.banner" alt="Banner de {{ comercio?.nombre }}" *ngIf="comercio?.banner"
      class="banner-img">
    <img src="assets/img/default-banner.png" alt="Banner predeterminado" *ngIf="!comercio?.banner" class="banner-img">
  </div>

  <!-- Logo e información del comercio -->
  <div class="store-profile-header">
    <div class="store-logo-container">
      <img [src]="comercio?.folder + comercio?.logo" alt="Logo de {{ comercio?.nombre }}" *ngIf="comercio?.logo"
        class="store-logo">
      <img src="assets/img/default-store.png" alt="Logo predeterminado" *ngIf="!comercio?.logo" class="store-logo">
    </div>

    <div class="store-info">
      <h2>{{ comercio?.nombre }}</h2>
      <p>{{comercio?.ciudad}} - {{comercio?.provincia}} - {{comercio?.pais}}</p>
    </div>

    <!-- Iconos de acción (favoritos, compartir, etc.) -->
    <div class="store-actions">
      <ion-button fill="clear" color="dark" size="small">
        <ion-icon name="heart-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" color="dark" size="small">
        <ion-icon name="share-social-outline"></ion-icon>
      </ion-button>
    </div>
  </div>


  <div class="store-extra">
    <div class="stat-item">
      <!-- Muestra siempre 5 estrellas y colorea según ComentariosRating -->
      <ng-container *ngFor="let star of [1, 2, 3, 4, 5]; let i = index">
        <ion-icon name="star" [style.color]="i < comercio?.ComentariosRating ? '#FFD700' : '#E0E0E0'"></ion-icon>
      </ng-container>

      <span>{{ comercio?.ComentariosRating || '0' }} ratings</span>
    </div>

    <div class="stat-item">
      <ion-icon name="location"></ion-icon>
      <span>Ubicación</span>
    </div>

    <div class="stat-item">
      <ion-icon name="time"></ion-icon>
      <span>Horario</span>
    </div>
  </div>

  <!-- Tabs de la tienda -->
  <div class="comercio-tabs" #comercioTabs>
    <ion-segment [(ngModel)]="selectedTab" scrollable>
      <ion-segment-button value="about">
        <ion-label>Nosotros</ion-label>
      </ion-segment-button>
      <ion-segment-button value="catalog">
        <ion-label>Catálogo</ion-label>
      </ion-segment-button>
      <ion-segment-button value="gallery">
        <ion-label>Galería</ion-label>
      </ion-segment-button>
      <ion-segment-button value="live">
        <ion-label>Go Live!</ion-label>
      </ion-segment-button>
      <ion-segment-button value="reservations">
        <ion-label>Reservas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="contact">
        <ion-label>Contacto</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Contenido del tab seleccionado -->
  <div [ngSwitch]="selectedTab">

    <!-- Tab Sobre Nosotros -->
    <div *ngSwitchCase="'about'">
      <!-- Iframe de la miniweb del comercio -->
      <p>Aquí van los datos</p>
    </div>

    <!-- Tab Catálogo -->
    <div *ngSwitchCase="'catalog'">

      <!-- Controles de filtros -->
      <div class="catalog-controls">
        <!-- Filtro para ordenar productos -->
        <ion-select [(ngModel)]="sortBy" interface="action-sheet" (ionChange)="sortProducts()">
          <ion-select-option value="relevance">Relevancia</ion-select-option>
          <ion-select-option value="low-to-high">Precio: Bajo a Alto</ion-select-option>
          <ion-select-option value="high-to-low">Precio: Alto a Bajo</ion-select-option>
          <ion-select-option value="newest">Últimos agregados</ion-select-option>
          <ion-select-option value="alphabetical">Orden Alfabético (A-Z)</ion-select-option>
        </ion-select>

        <!-- Filtro para vista (grid o lista) -->
        <ion-segment [(ngModel)]="viewMode" class="view-mode-toggle">
          <ion-segment-button value="grid">
            <ion-icon name="grid-outline"></ion-icon>
          </ion-segment-button>
          <ion-segment-button value="list">
            <ion-icon name="list-outline"></ion-icon>
          </ion-segment-button>
        </ion-segment>
      </div>

      <!-- Productos -->
      <ion-grid>

        <ion-row *ngIf="viewMode === 'grid'">
          <!-- Mostrar productos en grid -->
          <ion-col size="6" size-sm="6" size-md="4" size-lg="3" size-xl="2"
            *ngFor="let item of productos; let i = index">
            <div class="product-card">
              <img [src]="serverUrl + item.folder + item.foto_principal" class="product-img" />
              <h2>{{ item.titulo }}</h2>
              <p>{{ item.moneda }} {{ item.precio }}</p>
            </div>
          </ion-col>
        </ion-row>

        <ion-list *ngIf="viewMode === 'list'">
          <!-- Mostrar productos en lista -->
          <ion-item *ngFor="let item of productos">
            <ion-thumbnail slot="start">
              <img [src]="serverUrl + item.folder + item.foto_principal" />
            </ion-thumbnail>
            <ion-label>
              <h2>{{ item.titulo }}</h2>
              <p>{{ item.moneda }} {{ item.precio }}</p>
            </ion-label>
          </ion-item>
        </ion-list>

      </ion-grid>

      <!-- Infinite Scroll para cargar más productos -->
      <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreProducts($event)">
        <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Cargando más productos...">
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>

    </div>

    <!-- Otros tabs pueden ir aquí -->
  </div>

</ion-content>